<h2 id="1-overview">1. Overview</h2>
<p>이 튜토리얼에서는 Mockito API의 표준 정적 <code>mock</code> 메소드의 다양한 용도를 설명합니다.</p>
<p>Mockito 프레임워크(예: Mockito Verify 또는 Mockito When/Then)에 초점을 맞춘 다른 기사에서와 마찬가지로 아래 표시된 <code>MyList</code> 클래스는 테스트 사례에서 모의할 collaborator로 사용됩니다.</p>
<pre><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyList</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2 id="2-simple-mocking">2. Simple Mocking</h2>
<p><code>mock</code> 메소드의 가장 간단한 오버로드된 변형은 모의할 클래스에 대한 단일 매개변수를 갖는 것입니다:</p>
<pre><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> classToMock<span class="token punctuation">)</span></code></pre>
<p>우리는 클래스를 모의하고 기대치를 설정하기 위해 이 메소드를 사용할 것입니다:</p>
<pre><code class="language-java"><span class="token class-name">MyList</span> listMock <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">MyList</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">when</span><span class="token punctuation">(</span>listMock<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">anyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>그런 다음 모의 객체에서 메서드를 실행합니다.</p>
<pre><code class="language-java"><span class="token keyword">boolean</span> added <span class="token operator">=</span> listMock<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">randomAlphabetic</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>다음 코드는 모의 객체에서 <code>add</code> 메서드를 호출했음을 확인합니다. 호출은 이전에 설정한 기대와 일치하는 값을 반환합니다.</p>
<pre><code class="language-java"><span class="token function">verify</span><span class="token punctuation">(</span>listMock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">anyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assertThat</span><span class="token punctuation">(</span>added<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isFalse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="3-mocking-with-mocks-name">3. Mocking With Mock's Name</h2>
<p>이 섹션에서는 <code>mock</code> 메소드의 이름을 지정하는 인수와 함께 제공되는 모의 메소드의 또 다른 변형을 다룰 것입니다:</p>
<pre><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> classToMock<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span></code></pre>
<p>일반적으로 모의 이름은 작업 코드와 아무런 관련이 없습니다. 그러나 검증 오류를 추적하기 위해 모의 이름을 사용하므로 디버깅에 도움이 될 수 있습니다.</p>
<p>실패한 확인으로 인해 발생한 예외 메시지에 제공된 모의 이름이 포함되어 있는지 확인하기 위해 <code>assertThatThrownBy</code>를 사용합니다.<br>
다음 코드에서는 <code>MyList</code> 클래스에 대한 모의 클래스를 만들고 이름을 <code>myMock</code>으로 지정합니다.</p>
<pre><code class="language-java"><span class="token class-name">MyList</span> listMock <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">MyList</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">"myMock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>그런 다음 모의 메서드에 대한 기대치를 설정하고 실행합니다.</p>
<pre><code class="language-java"><span class="token function">when</span><span class="token punctuation">(</span>listMock<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">anyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
listMock<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">randomAlphabetic</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>다음으로, <code>assertThatThrownBy</code> 내에서 확인을 호출하고 발생한 예외의 인스턴스를 확인하겠습니다.</p>
<pre><code class="language-java"><span class="token function">assertThatThrownBy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">verify</span><span class="token punctuation">(</span>listMock<span class="token punctuation">,</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">anyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isInstanceOf</span><span class="token punctuation">(</span><span class="token class-name">TooFewActualInvocations</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></code></pre>
<p>또한 모의 객체에 대한 정보를 포함해야 한다는 예외 메시지를 확인할 수도 있습니다.</p>
<pre><code class="language-java"><span class="token function">assertThatThrownBy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">verify</span><span class="token punctuation">(</span>listMock<span class="token punctuation">,</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">anyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isInstanceOf</span><span class="token punctuation">(</span><span class="token class-name">TooFewActualInvocations</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">hasMessageContaining</span><span class="token punctuation">(</span><span class="token string">"myMock.add"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>발생한 예외 메시지는 다음과 같습니다.</p>
<pre><code class="language-shell">org.mockito.exceptions.verification.TooLittleActualInvocations:
myMock.add<span class="token punctuation">(</span><span class="token operator">&lt;</span>any<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Wanted <span class="token number">2</span> times:
at com.baeldung.mockito.MockitoMockTest
  .whenUsingMockWithName_thenCorrect<span class="token punctuation">(</span>MockitoMockTest.java:<span class="token punctuation">..</span>.<span class="token punctuation">)</span>
but was <span class="token number">1</span> time:
at com.baeldung.mockito.MockitoMockTest
  .whenUsingMockWithName_thenCorrect<span class="token punctuation">(</span>MockitoMockTest.java:<span class="token punctuation">..</span>.<span class="token punctuation">)</span></code></pre>
<p>보시다시피, 예외 메시지에는 모의 이름이 포함되어 있는데, 이는 검증에 실패한 경우 실패 지점을 찾는 데 유용합니다.</p>
<h2 id="4-mocking-with-answer">4. Mocking With <code>Answer</code></h2>
<p>여기서는 생성 시 상호 작용에 대한 모의 응답에 대한 전략을 구성하는 <code>mock</code> 변형의 사용을 보여줍니다. Mockito 문서의 이 <code>mock</code> 메서드 시그니처는 다음과 같습니다.</p>
<pre><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> classToMock<span class="token punctuation">,</span> <span class="token class-name">Answer</span> defaultAnswer<span class="token punctuation">)</span></code></pre>
<p><code>Answer</code> 인터페이스 구현의 정의부터 시작해 보겠습니다.</p>
<pre><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">CustomAnswer</span> <span class="token keyword">implements</span> <span class="token class-name">Answer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">answer</span><span class="token punctuation">(</span><span class="token class-name">InvocationOnMock</span> invocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>모의 생성을 위해 위의 <code>CustomAnswer</code> 클래스를 사용합니다.</p>
<pre><code class="language-java"><span class="token class-name">MyList</span> listMock <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">MyList</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CustomAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>메서드에 대한 기대치를 설정하지 않으면 <code>CustomAnswer</code> 유형으로 구성된 기본 답변이 적용됩니다. 이를 증명하기 위해 기대 설정 단계를 건너뛰고 메서드 실행으로 넘어갑니다.</p>
<pre><code class="language-java"><span class="token keyword">boolean</span> added <span class="token operator">=</span> listMock<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">randomAlphabetic</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>다음 확인 및 주장은 <code>Answer</code> 인수가 있는 모의 메서드가 예상대로 작동했음을 확인합니다.</p>
<pre><code class="language-java"><span class="token function">verify</span><span class="token punctuation">(</span>listMock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">anyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assertThat</span><span class="token punctuation">(</span>added<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isFalse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="5-mocking-with-mocksettings">5. Mocking With <code>MockSettings</code></h2>
<p>이 글에서 우리가 다룰 마지막 모의 메소드는 <code>MockSettings</code> 유형의 매개변수를 가진 변형입니다. 우리는 비표준 모의를 제공하기 위해 이 오버로드된 메서드를 사용합니다.</p>
<p><code>invocationListeners</code>를 사용하여 현재 모의에서 메서드 호출을 위한 리스너 등록, <code>serializable</code>으로 직렬화 구성, <code>spiedInstance</code>로 감시할 인스턴스 지정, 생성자 사용을 시도하도록 Mockito 구성 등 <code>MockSettings</code> 인터페이스의 메서드에서 지원되는 여러 사용자 정의 설정이 있습니다. <code>useConstructor</code> 등을 사용하여 모의 객체를 인스턴스화할 때</p>
<p>편의를 위해 이전 섹션에서 소개한 <code>CustomAnswer</code> 클래스를 재사용하여 기본 답변을 정의하는 <code>MockSettings</code> 구현을 생성하겠습니다.</p>
<p><code>MockSettings</code> 객체는 팩토리 메소드에 의해 인스턴스화됩니다.</p>
<pre><code class="language-java"><span class="token class-name">MockSettings</span> customSettings <span class="token operator">=</span> <span class="token function">withSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">defaultAnswer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>우리는 새로운 모의 객체를 생성할 때 해당 설정 객체를 사용할 것입니다:</p>
<pre><code class="language-java"><span class="token class-name">MyList</span> listMock <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">MyList</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> customSettings<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>이전 섹션과 유사하게 <code>MyList</code> 인스턴스의 <code>add</code> 메소드를 호출하고 <code>MockSettings</code> 인수가 있는 <code>mock</code> 메소드가 예상대로 작동하는지 확인합니다.</p>
<pre><code class="language-java"><span class="token keyword">boolean</span> added <span class="token operator">=</span> listMock<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">randomAlphabetic</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">verify</span><span class="token punctuation">(</span>listMock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">anyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assertThat</span><span class="token punctuation">(</span>added<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isFalse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>