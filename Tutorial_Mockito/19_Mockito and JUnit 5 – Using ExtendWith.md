<h2 id="1-overview">1. Overview</h2>
<p>이 빠른 튜토리얼에서는 Mockito를 JUnit 5 확장 모델과 통합하는 방법을 보여줍니다. JUnit 5 확장 모델에 대해 자세히 알아보려면 이 기사를 살펴보세요.</p>
<p>먼저, <code>@Mock</code>으로 어노테이션이 달린 클래스 속성이나 메소드 매개변수에 대한 모의 객체를 자동으로 생성하는 확장을 생성하는 방법을 보여드리겠습니다.</p>
<p>그런 다음 JUnit 5 테스트 클래스에서 Mockito 확장을 사용하겠습니다.</p>
<h2 id="2-maven-dependencies">2. Maven Dependencies</h2>
<p><code>pom.xml</code>에 JUnit 5(<code>jupiter</code>) 및 <code>mockito</code> 종속성을 추가해 보겠습니다.</p>
<pre><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.jupiter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-jupiter-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.9.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mockito<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mockito-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></code></pre>
<h2 id="3-mockito-extension">3. Mockito Extension</h2>
<p><code>Mockito</code>는 라이브러리(mockito-junit-jupiter)에서 JUnit5 확장에 대한 구현을 제공합니다. <code>pom.xml</code>에 이 종속성을 포함하겠습니다.</p>
<pre><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mockito<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mockito-junit-jupiter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></code></pre>
<h2 id="4-building-the-test-class">4. Building the Test Class</h2>
<p>테스트 클래스를 구축하고 여기에 Mockito 확장을 연결해 보겠습니다.</p>
<pre><code class="language-java"><span class="token annotation punctuation">@ExtendWith</span><span class="token punctuation">(</span><span class="token class-name">MockitoExtension</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">UserServiceUnitTest</span> <span class="token punctuation">{</span>

    <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre>
<p><code>@Mock</code> 어노테이션을 사용하여 테스트 클래스의 어느 곳에서나 사용할 수 있는 인스턴스 변수에 대한 모의 변수를 삽입할 수 있습니다.</p>
<pre><code class="language-java"><span class="token annotation punctuation">@Mock</span> <span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">;</span></code></pre>
<p>또한, 메소드 매개변수에 모의 객체를 삽입할 수 있습니다:</p>
<pre><code class="language-java"><span class="token annotation punctuation">@BeforeEach</span>
<span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Mock</span> <span class="token class-name">SettingRepository</span> settingRepository<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    userService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultUserService</span><span class="token punctuation">(</span>userRepository<span class="token punctuation">,</span> settingRepository<span class="token punctuation">,</span> mailClient<span class="token punctuation">)</span><span class="token punctuation">;</span>
      
    <span class="token function">lenient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>settingRepository<span class="token punctuation">.</span><span class="token function">getUserMinAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token function">when</span><span class="token punctuation">(</span>settingRepository<span class="token punctuation">.</span><span class="token function">getUserNameMinLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token function">lenient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>userRepository<span class="token punctuation">.</span><span class="token function">isUsernameAlreadyExists</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>여기서는 <code>lenient()</code> 사용에 유의하세요. <code>Mockito</code>는 실행 중에 테스트 메서드 중 하나에 의해 초기화된 모의 객체가 호출되지 않으면 <code>UnsupportedStubbingException</code>을 발생시킵니다. 모의 객체를 초기화할 때 이 방법을 사용하면 엄격한 스텁 검사를 피할 수 있습니다.</p>
<p>테스트 메소드 매개변수에 모의 객체를 주입할 수도 있습니다:</p>
<pre><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">givenValidUser_whenSaveUser_thenSucceed</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Mock</span> <span class="token class-name">MailClient</span> mailClient<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Given</span>
    user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"Jerry"</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">when</span><span class="token punctuation">(</span>userRepository<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Answer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> sequence <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">answer</span><span class="token punctuation">(</span><span class="token class-name">InvocationOnMock</span> invocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
            <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> invocation<span class="token punctuation">.</span><span class="token function">getArgument</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>sequence<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> user<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    userService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultUserService</span><span class="token punctuation">(</span>userRepository<span class="token punctuation">,</span> settingRepository<span class="token punctuation">,</span> mailClient<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// When</span>
    <span class="token class-name">User</span> insertedUser <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token comment">// Then</span>
    <span class="token function">verify</span><span class="token punctuation">(</span>userRepository<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertNotNull</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">verify</span><span class="token punctuation">(</span>mailClient<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendUserRegistrationMail</span><span class="token punctuation">(</span>insertedUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>테스트 매개변수로 주입한 <code>MailClient</code> 모의는 <code>init</code> 메소드에 주입한 인스턴스와 동일하지 않습니다.</p>