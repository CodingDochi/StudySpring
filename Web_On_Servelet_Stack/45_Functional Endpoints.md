<p>Spring Web MVC에는 요청을 라우팅하고 처리하는 데 함수가 사용되며 불변성을 위해 설계된 계약인 경량 기능 프로그래밍 모델인 WebMvc.fn이 포함되어 있습니다. 이는 주석 기반 프로그래밍 모델의 대안이지만 동일한 <a href="https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-servlet.html">DispatcherServlet</a>에서 실행됩니다.</p>
<h1 id="overview">Overview</h1>
<p><a href="https://docs.spring.io/spring-framework/reference/web/webflux-functional.html#webflux-fn-overview">반응형 스택에서 이에 상응하는 내용 보기</a></p>
<p>WebMvc.fn에서 HTTP 요청은 <code>ServerRequest</code>를 가져와 <code>ServerResponse</code>를 반환하는 함수인 <code>HandlerFunction</code>을 통해 처리됩니다. 요청과 응답 객체 모두 HTTP 요청과 응답에 대한 JDK 8 친화적인 액세스를 제공하는 불변 계약을 갖고 있습니다. <code>HandlerFunction</code>은 annotation 기반 프로그래밍 모델의 <code>@RequestMapping</code> 메소드 본문과 동일합니다.</p>
<p>들어오는 요청은 <code>RouterFunction</code>이 있는 핸들러 함수로 라우팅됩니다. 이 함수는 <code>ServerRequest</code>를 가져와 선택적 <code>HandlerFunction</code>(예: <code>Optional&lt;HandlerFunction&gt;</code>)을 반환합니다. 라우터 함수가 일치하면 핸들러 함수가 반환됩니다. 그렇지 않으면 비어 있는 Optional입니다. <code>RouterFunction</code>은 <code>@RequestMapping</code> annotation과 동일하지만 라우터 기능이 데이터뿐만 아니라 동작도 제공한다는 주요 차이점이 있습니다.</p>
<p><code>RouterFunctions.route()</code>는 다음 예제와 같이 라우터 생성을 용이하게 하는 라우터 빌더를 제공합니다.</p>
<pre><code class="language-java"><span class="token class-name">PersonRepository</span> repository <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">PersonHandler</span> handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PersonHandler</span><span class="token punctuation">(</span>repository<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> route <span class="token operator">=</span> <span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// (1)</span>
	<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/person/{id}"</span><span class="token punctuation">,</span> <span class="token function">accept</span><span class="token punctuation">(</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">,</span> handler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">getPerson</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/person"</span><span class="token punctuation">,</span> <span class="token function">accept</span><span class="token punctuation">(</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">,</span> handler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">listPeople</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"/person"</span><span class="token punctuation">,</span> handler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">createPerson</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PersonHandler</span> <span class="token punctuation">{</span>

	<span class="token comment">// ...</span>

	<span class="token keyword">public</span> <span class="token class-name">ServerResponse</span> <span class="token function">listPeople</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">ServerResponse</span> <span class="token function">createPerson</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">ServerResponse</span> <span class="token function">getPerson</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>(1) <code>route()</code>를 사용하여 라우터를 생성합니다.</p>
<p>예를 들어 <code>@Configuration</code> 클래스에 노출하여 <code>RouterFunction</code>을 빈으로 등록하면 <a href="https://docs.spring.io/spring-framework/reference/web/webmvc-functional.html#webmvc-fn-running">서버 실행</a>에 설명된 대로 서블릿에 의해 자동 감지됩니다.</p>
<h1 id="handlerfunction">HandlerFunction</h1>
<p><a href="https://docs.spring.io/spring-framework/reference/web/webflux-functional.html#webflux-fn-handler-functions">반응형 스택에서 이에 상응하는 내용 보기</a> </p>
<p><code>ServerRequest</code> 및 <code>ServerResponse</code>는 헤더, 본문, 메서드 및 상태 코드를 포함하여 HTTP 요청 및 응답에 대한 JDK 8 친화적인 액세스를 제공하는 불변 인터페이스입니다.</p>
<h2 id="serverrequest">ServerRequest</h2>
<p><code>ServerRequest</code>는 HTTP 메서드, URI, 헤더 및 쿼리 매개 변수에 대한 액세스를 제공하는 반면, 본문에 대한 액세스는 <code>body</code> 메서드를 통해 제공됩니다. 다음 예에서는 요청 본문을 <code>String</code>로 추출합니다.</p>
<pre><code class="language-java"><span class="token class-name">String</span> string <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>다음 예에서는 본문을 <code>List&lt;Person&gt;</code>으로 추출합니다. 여기서 <code>Person</code> 객체는 JSON 또는 XML과 같은 직렬화된 형식에서 디코딩됩니다.</p>
<pre><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> people <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ParameterizedTypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>다음 예에서는 매개변수에 액세스하는 방법을 보여줍니다.</p>
<pre><code class="language-java"><span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">params</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="serverresponse">ServerResponse</h2>
<p><code>ServerResponse</code>는 HTTP 응답에 대한 액세스를 제공하며, 변경이 불가능하므로 <code>build</code> 메서드를 사용하여 생성할 수 있습니다. 빌더를 사용하여 응답 상태를 설정하거나, 응답 헤더를 추가하거나, 본문을 제공할 수 있습니다. 다음 예에서는 JSON 콘텐츠로 200(OK) 응답을 생성합니다.</p>
<pre><code class="language-java"><span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>다음 예에서는 본문 없이 <code>Location</code> 헤더를 사용하여 201(CREATED) 응답을 작성하는 방법을 보여줍니다.</p>
<pre><code class="language-java"><span class="token class-name">URI</span> location <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">created</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><code>CompletableFuture</code>, <code>Publisher</code> 또는 <code>ReactiveAdapterRegistry</code>에서 지원하는 기타 유형의 비동기 결과를 본문으로 사용할 수도 있습니다. 예를 들어:</p>
<pre><code class="language-java"><span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> person <span class="token operator">=</span> webClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bodyToMono</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>본문뿐만 아니라 상태 또는 헤더도 비동기 유형을 기반으로 하는 경우 <code>CompletableFuture&lt;ServerResponse&gt;</code>, <code>Publisher&lt;ServerResponse&gt;</code> 또는 <code>ReactiveAdapterRegistry</code>에서 지원하는 기타 비동기 유형을 허용하는 <code>ServerResponse</code>의 static <code>async</code> 메서드를 사용할 수 있습니다. . 예를 들어:</p>
<pre><code class="language-java"><span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> asyncResponse <span class="token operator">=</span> webClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bodyToMono</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>p <span class="token operator">-&gt;</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Name"</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span>asyncResponse<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><a href="https://www.w3.org/TR/eventsource/">서버 전송 이벤트</a>는 <code>ServerResponse</code>의 정적 <code>sse</code> 메서드를 통해 제공될 수 있습니다. 해당 메소드에서 제공하는 빌더를 사용하면 문자열 또는 기타 객체를 JSON으로 보낼 수 있습니다. 예를 들어:</p>
<pre><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">sse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">route</span><span class="token punctuation">(</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/sse"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request <span class="token operator">-&gt;</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">sse</span><span class="token punctuation">(</span>sseBuilder <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
				<span class="token comment">// Save the sseBuilder object somewhere..</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// In some other thread, sending a String</span>
sseBuilder<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Or an object, which will be transformed into JSON</span>
<span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
sseBuilder<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Customize the event by using the other methods</span>
sseBuilder<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">"42"</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">event</span><span class="token punctuation">(</span><span class="token string">"sse event"</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// and done at some point</span>
sseBuilder<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="handler-classes">Handler Classes</h2>
<p>다음 예제와 같이 핸들러 함수를 람다로 작성할 수 있습니다.</p>
<pre><code class="language-java"><span class="token class-name">HandlerFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> helloWorld <span class="token operator">=</span>
  request <span class="token operator">-&gt;</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>이는 편리하지만 애플리케이션에는 여러 함수가 필요하고 여러 인라인 람다를 사용하면 지저분해질 수 있습니다. 따라서 관련 핸들러 함수를 주석 기반 애플리케이션에서 <code>@Controller</code>와 유사한 역할을 하는 핸들러 클래스로 그룹화하는 것이 유용합니다. 예를 들어 다음 클래스는 반응형 <code>Person</code> repository를 노출합니다.</p>
<pre><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PersonHandler</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">PersonRepository</span> repository<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">PersonHandler</span><span class="token punctuation">(</span><span class="token class-name">PersonRepository</span> repository<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>repository <span class="token operator">=</span> repository<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">ServerResponse</span> <span class="token function">listPeople</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// (1)</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> people <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">allPeople</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>people<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">ServerResponse</span> <span class="token function">createPerson</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span> <span class="token comment">// (2)</span>
		<span class="token class-name">Person</span> person <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		repository<span class="token punctuation">.</span><span class="token function">savePerson</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">ServerResponse</span> <span class="token function">getPerson</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// (3)</span>
		<span class="token keyword">int</span> personId <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">pathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Person</span> person <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">getPerson</span><span class="token punctuation">(</span>personId<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>person <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">notFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<p>(1) <code>listPeople</code>은 repository에 있는 모든 <code>Person</code> 객체를 JSON으로 반환하는 핸들러 함수입니다.<br>
(2) <code>createPerson</code>은 요청 본문에 포함된 새 <code>Person</code>을 저장하는 핸들러 함수입니다.<br>
(3) <code>getPerson</code>은 <code>id</code> 경로 변수로 식별되는 단일 사람을 반환하는 핸들러 함수입니다. 저장소에서 해당 <code>Person</code>을 검색하고, 발견되면 JSON 응답을 생성합니다. 찾을 수 없으면 404 Not Found 응답을 반환합니다.</p>
<h2 id="validation">Validation</h2>
<p>functional 엔드포인트는 Spring의 <a href="https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-config/validation.html">검증 기능</a>을 사용하여 요청 본문에 검증을 적용할 수 있습니다. 예를 들어 <code>Person</code>에 대한 사용자 정의 Spring <a href="https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-config/validation.html">Validator</a> 구현이 있다고 가정해 보겠습니다.</p>
<pre><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PersonHandler</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Validator</span> validator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PersonValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// (1)</span>

	<span class="token comment">// ...</span>

	<span class="token keyword">public</span> <span class="token class-name">ServerResponse</span> <span class="token function">createPerson</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Person</span> person <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">validate</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// (2)</span>
		repository<span class="token punctuation">.</span><span class="token function">savePerson</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">validate</span><span class="token punctuation">(</span><span class="token class-name">Person</span> person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Errors</span> errors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeanPropertyBindingResult</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token string">"person"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		validator<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> errors<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ServerWebInputException</span><span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// (3)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>(1) <code>Validator</code> 인스턴스를 만듭니다.<br>
(2) 유효성 검사를 적용합니다.<br>
(3) 400 응답에 대한 예외를 발생시킵니다.</p>
<p>핸들러는 <code>LocalValidatorFactoryBean</code>을 기반으로 전역 <code>Validator</code> 인스턴스를 생성하고 주입하여 표준 Bean 유효성 검사 API(JSR-303)를 사용할 수도 있습니다. 스프링 <a href="https://docs.spring.io/spring-framework/reference/core/validation/beanvalidation.html">유효성 검사</a>를 참조하세요.</p>
<h1 id="routerfunction"><code>RouterFunction</code></h1>
<p><a href="https://docs.spring.io/spring-framework/reference/web/webflux-functional.html#webflux-fn-router-functions">반응형 스택에서 이에 상응하는 내용 보기</a></p>
<p>라우터 기능은 요청을 해당 <code>HandlerFunction</code>으로 라우팅하는 데 사용됩니다. 일반적으로 라우터 함수를 직접 작성하지 않고 <code>RouterFunctions</code> 유틸리티 클래스의 메서드를 사용하여 만듭니다. <code>RouterFunctions.route()</code>(매개변수 없음)는 라우터 기능을 생성하기 위한 유연한 빌더를 제공하는 반면, <code>RouterFunctions.route(RequestPredicate, HandlerFunction)</code>는 라우터를 생성하는 직접적인 방법을 제공합니다.</p>
<p>일반적으로, 찾기 어려운 정적 가져오기를 요구하지 않고 일반적인 매핑 시나리오에 대한 편리한 지름길을 제공하는 <code>route()</code> 빌더를 사용하는 것이 좋습니다. 예를 들어, 라우터 기능 빌더는 GET 요청에 대한 매핑을 생성하기 위해 <code>GET(String, HandlerFunction)</code> 메서드를 제공합니다. POST의 경우 <code>POST(String, HandlerFunction)</code>입니다.</p>
<p>HTTP 메서드 기반 매핑 외에도 경로 빌더는 요청에 매핑할 때 추가 조건자를 도입하는 방법을 제공합니다. 각 HTTP 메서드에는 <code>RequestPredicate</code>를 매개변수로 사용하는 오버로드된 변형이 있으며 이를 통해 추가 제약 조건을 표현할 수 있습니다.</p>
<h2 id="predicates">Predicates</h2>
<p>자신만의 <code>RequestPredicate</code>를 작성할 수 있지만 <code>RequestPredicates</code> 유틸리티 클래스는 요청 경로, HTTP 메서드, 콘텐츠 유형 등에 따라 일반적으로 사용되는 구현을 제공합니다. 다음 예에서는 요청 조건자를 사용하여 <code>Accept</code> 헤더를 기반으로 제약 조건을 만듭니다.</p>
<pre><code class="language-java"><span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> route <span class="token operator">=</span> <span class="token class-name">RouterFunctions</span><span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/hello-world"</span><span class="token punctuation">,</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>TEXT_PLAIN<span class="token punctuation">)</span><span class="token punctuation">,</span>
		request <span class="token operator">-&gt;</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>다음을 사용하여 여러 요청 predicate를 함께 구성할 수 있습니다.</p>
<ul>
<li>
<p><code>RequestPredicate.and(RequestPredicate) </code>— 둘 다 일치해야 합니다.</p>
</li>
<li>
<p><code>RequestPredicate.or(RequestPredicate)</code> — 둘 중 하나가 일치할 수 있습니다.</p>
</li>
</ul>
<p><code>RequestPredicates</code>의 많은 predicates가 구성됩니다. 예를 들어 <code>RequestPredicates.GET(String)</code>은 <code>RequestPredicates.method(HttpMethod)</code> 및 <code>RequestPredicates.path(String)</code>로 구성됩니다. 위에 표시된 예에서는 빌더가 내부적으로 <code>RequestPredicates.GET</code>을 사용하고 이를 <code>accept</code> predicate로 구성하므로 두 개의 요청 조건자를 사용합니다.</p>
<h2 id="routes">Routes</h2>
<p>라우터 기능은 순서대로 평가됩니다. 첫 번째 경로가 일치하지 않으면 두 번째 경로가 평가되는 식입니다. 따라서 일반 경로보다 구체적인 경로를 선언하는 것이 합리적입니다. 이는 나중에 설명하겠지만 라우터 기능을 Spring 빈으로 등록할 때에도 중요합니다. 이 동작은 "가장 구체적인" 컨트롤러 메서드가 자동으로 선택되는 주석 기반 프로그래밍 모델과 다릅니다.</p>
<p>라우터 함수 빌더를 사용할 때 정의된 모든 경로는 <code>build()</code>에서 반환되는 하나의 <code>RouterFunction</code>으로 구성됩니다. 여러 라우터 기능을 함께 구성하는 다른 방법도 있습니다.</p>
<ul>
<li>
<p><code>RouterFunctions.route()</code> 빌더에 <code>add(RouterFunction)</code></p>
</li>
<li>
<p><code>RouterFunction.and(RouterFunction)</code></p>
</li>
<li>
<p><code>RouterFunction.andRoute(RequestPredicate, HandlerFunction)</code>  - 중첩된 <code>RouterFunctions.route()</code>가 있는 <code>RouterFunction.and()</code>의 단축키입니다.</p>
</li>
</ul>
<p>다음 예에서는 네 가지 경로의 구성을 보여줍니다.</p>
<pre><code class="language-java"><span class="token class-name">PersonRepository</span> repository <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">PersonHandler</span> handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PersonHandler</span><span class="token punctuation">(</span>repository<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> otherRoute <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> route <span class="token operator">=</span> <span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/person/{id}"</span><span class="token punctuation">,</span> <span class="token function">accept</span><span class="token punctuation">(</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">,</span> handler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">getPerson</span><span class="token punctuation">)</span> <span class="token comment">// (1)</span>
	<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/person"</span><span class="token punctuation">,</span> <span class="token function">accept</span><span class="token punctuation">(</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">,</span> handler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">listPeople</span><span class="token punctuation">)</span>  <span class="token comment">// (2)</span>
	<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"/person"</span><span class="token punctuation">,</span> handler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">createPerson</span><span class="token punctuation">)</span>  <span class="token comment">// (3)</span>
	<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>otherRoute<span class="token punctuation">)</span>   <span class="token comment">// (4)</span>
	<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>(1) JSON과 일치하는 <code>Accept</code> 헤더가 있는 <code>GET /person/{id}</code>는 <code>PersonHandler.getPerson</code>으로 라우팅됩니다.<br>
(2) JSON과 일치하는 <code>Accept</code> 헤더가 있는 <code>GET /person</code>은 <code>PersonHandler.listPeople</code>로 라우팅됩니다.<br>
(3) 추가 조건자가 없는 <code>POST /person</code>은 <code>PersonHandler.createPerson</code>에 매핑됩니다.<br>
(4) <code>otherRoute</code>는 다른 곳에서 생성되어 구축된 경로에 추가되는 라우터 기능입니다.</p>
<h2 id="nested-routes">Nested Routes</h2>
<p>라우터 기능 그룹이 공유 경로와 같은 공유 predicate를 갖는 것이 일반적입니다. 위의 예에서 공유 predicate는 세 개의 경로에서 사용되는 <code>/person</code>과 일치하는 경로 predicate가 됩니다. annotation을 사용할 때 <code>/person</code>에 매핑되는 유형 수준 <code>@RequestMapping</code> annotation을 사용하여 이 중복을 제거합니다. WebMvc.fn에서 경로 조건자는 라우터 기능 빌더의 <code>path</code> 메서드를 통해 공유될 수 있습니다. 예를 들어, 위 예제의 마지막 몇 줄은 중첩된 경로를 사용하여 다음과 같은 방식으로 개선될 수 있습니다.</p>
<pre><code class="language-java"><span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> route <span class="token operator">=</span> <span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/person"</span><span class="token punctuation">,</span> builder <span class="token operator">-&gt;</span> builder <span class="token comment">// (1)</span>
		<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/{id}"</span><span class="token punctuation">,</span> <span class="token function">accept</span><span class="token punctuation">(</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">,</span> handler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">getPerson</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token function">accept</span><span class="token punctuation">(</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">,</span> handler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">listPeople</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span>handler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">createPerson</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>(1) <code>path</code>의 두 번째 매개변수는 라우터 빌더를 사용하는 소비자입니다.</p>
<p>경로 기반 중첩이 가장 일반적이지만 빌더에서 <code>nest</code> 메소드를 사용하여 모든 종류의 조건자에 중첩할 수 있습니다. 위 내용에는 여전히 공유 <code>Accept</code>-header 조건자의 형태로 일부 중복이 포함되어 있습니다. <code>accept</code>와 함께 <code>nest</code> 메소드를 사용하면 더욱 개선할 수 있습니다.</p>
<pre><code class="language-java"><span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> route <span class="token operator">=</span> <span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/person"</span><span class="token punctuation">,</span> b1 <span class="token operator">-&gt;</span> b1
		<span class="token punctuation">.</span><span class="token function">nest</span><span class="token punctuation">(</span><span class="token function">accept</span><span class="token punctuation">(</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">,</span> b2 <span class="token operator">-&gt;</span> b2
			<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/{id}"</span><span class="token punctuation">,</span> handler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">getPerson</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span>handler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">listPeople</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span>handler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">createPerson</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h1 id="serving-resources">Serving Resources</h1>
<p>WebMvc.fn은 리소스 제공을 위한 기본 지원을 제공합니다.</p>
<blockquote>
<p><strong>[Note]</strong><br>
아래 설명된 기능 외에도 <code>RouterFunctions#resource(java.util.function.Function)</code> 덕분에 더욱 유연한 리소스 처리를 구현할 수 있습니다.</p>
</blockquote>
<h2 id="redirecting-to-a-resource">Redirecting to a resource</h2>
<p>지정된 predicate와 일치하는 요청을 리소스로 리디렉션할 수 있습니다. 예를 들어 단일 페이지 애플리케이션에서 리디렉션을 처리하는 데 유용할 수 있습니다.</p>
<pre><code class="language-java">   <span class="token class-name">ClassPathResource</span> index <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">"static/index.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> extensions <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"js"</span><span class="token punctuation">,</span> <span class="token string">"css"</span><span class="token punctuation">,</span> <span class="token string">"ico"</span><span class="token punctuation">,</span> <span class="token string">"png"</span><span class="token punctuation">,</span> <span class="token string">"jpg"</span><span class="token punctuation">,</span> <span class="token string">"gif"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">RequestPredicate</span> spaPredicate <span class="token operator">=</span> <span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/api/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/error"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token function">pathExtension</span><span class="token punctuation">(</span>extensions<span class="token operator">:</span><span class="token operator">:</span><span class="token function">contains</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">negate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> redirectToIndex <span class="token operator">=</span> <span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">resource</span><span class="token punctuation">(</span>spaPredicate<span class="token punctuation">,</span> index<span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="serving-resources-from-a-root-location">Serving resources from a root location</h2>
<p>주어진 패턴과 일치하는 요청을 주어진 루트 위치를 기준으로 한 리소스로 라우팅하는 것도 가능합니다.</p>
<pre><code class="language-java"><span class="token class-name">Resource</span> location <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileSystemResource</span><span class="token punctuation">(</span><span class="token string">"public-resources/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> resources <span class="token operator">=</span> <span class="token class-name">RouterFunctions</span><span class="token punctuation">.</span><span class="token function">resources</span><span class="token punctuation">(</span><span class="token string">"/resources/**"</span><span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h1 id="running-a-server">Running a Server</h1>
<p><a href="https://docs.spring.io/spring-framework/reference/web/webflux-functional.html#webflux-fn-running">반응형 스택에서 이에 상응하는 내용 보기</a></p>
<p>일반적으로 Spring 구성을 사용하여 요청을 처리하는 데 필요한 구성 요소를 선언하는 <a href="https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-config.html">MVC 구성</a>을 통해 <a href="https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-servlet.html"><code>DispatcherHandler</code></a> 기반 설정에서 라우터 기능을 실행합니다. MVC Java 구성은 기능적 끝점을 지원하기 위해 다음 인프라 구성 요소를 선언합니다.</p>
<ul>
<li>
<p><code>RouterFunctionMapping</code>: Spring 구성에서 하나 이상의 <code>RouterFunction&lt;?&gt;</code> Bean을 감지하고 <a href="https://docs.spring.io/spring-framework/reference/core/beans/annotation-config/autowired.html#beans-factory-ordered">순서를 지정</a>하며 <code>RouterFunction.andOther</code>를 통해 결합하고 결과적으로 구성된 <code>RouterFunction</code>으로 요청을 라우팅합니다.</p>
</li>
<li>
<p><code>HandlerFunctionAdapter</code>: <code>DispatcherHandler</code>가 요청에 매핑된 <code>HandlerFunction</code>을 호출할 수 있게 해주는 간단한 어댑터입니다.</p>
</li>
</ul>
<p>앞선 구성 요소를 사용하면 기능적 끝점이 <code>DispatcherServlet</code> 요청 처리 수명 주기에 맞도록 할 수 있으며 선언된 경우 주석이 달린 컨트롤러와 함께 (잠재적으로) 나란히 실행될 수도 있습니다. 이는 또한 Spring Boot 웹 스타터에서 기능적 엔드포인트를 활성화하는 방법이기도 합니다.</p>
<p>다음 예는 WebFlux Java 구성을 보여줍니다.</p>
<pre><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableMvc</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">routerFunctionA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">routerFunctionB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// ...</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configureMessageConverters</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> converters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// configure message conversion...</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addCorsMappings</span><span class="token punctuation">(</span><span class="token class-name">CorsRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// configure CORS...</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configureViewResolvers</span><span class="token punctuation">(</span><span class="token class-name">ViewResolverRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// configure view resolution for HTML rendering...</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h1 id="filtering-handler-functions">Filtering Handler Functions</h1>
<p><a href="https://docs.spring.io/spring-framework/reference/web/webflux-functional.html#webflux-fn-handler-filter-function">반응형 스택에서 이에 상응하는 내용 보기</a></p>
<p>라우팅 함수 빌더에서 <code>before</code>, <code>after</code> 또는 <code>filter</code> 메서드를 사용하여 핸들러 함수를 필터링할 수 있습니다. annotation을 사용하면 <code>@ControllerAdvice</code>, <code>ServletFilter</code> 또는 둘 다를 사용하여 유사한 기능을 얻을 수 있습니다. 필터는 빌더가 구축한 모든 경로에 적용됩니다. 이는 중첩된 경로에 정의된 필터가 "최상위" 경로에 적용되지 않음을 의미합니다. 예를 들어 다음 예를 고려해보세요.</p>
<pre><code class="language-java"><span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> route <span class="token operator">=</span> <span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/person"</span><span class="token punctuation">,</span> b1 <span class="token operator">-&gt;</span> b1
		<span class="token punctuation">.</span><span class="token function">nest</span><span class="token punctuation">(</span><span class="token function">accept</span><span class="token punctuation">(</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">,</span> b2 <span class="token operator">-&gt;</span> b2
			<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/{id}"</span><span class="token punctuation">,</span> handler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">getPerson</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span>handler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">listPeople</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span>request <span class="token operator">-&gt;</span> <span class="token class-name">ServerRequest</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>  <span class="token comment">// (1)</span>
				<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"X-RequestHeader"</span><span class="token punctuation">,</span> <span class="token string">"Value"</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span>handler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">createPerson</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">logResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// (2)</span>
	<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>(1) 사용자 정의 요청 헤더를 추가하는 <code>before</code> 필터는 두 개의 <code>GET</code> 경로에만 적용됩니다.<br>
(2) 응답을 기록하는 <code>after</code> 필터는 중첩된 경로를 포함한 모든 경로에 적용됩니다.</p>
<p>라우터 빌더의 <code>filter</code> 메소드는 <code>HandlerFilterFunction</code>을 사용합니다. 이 함수는 <code>ServerRequest</code> 및 <code>HandlerFunction</code>을 사용하고 <code>ServerResponse</code>를 반환합니다. 핸들러 함수 매개변수는 체인의 다음 요소를 나타냅니다. 이는 일반적으로 라우팅되는 핸들러이지만 여러 필터가 적용되는 경우 다른 필터가 될 수도 있습니다.</p>
<p>이제 특정 경로가 허용되는지 여부를 결정할 수 있는 <code>SecurityManager</code>가 있다고 가정하고 경로에 간단한 보안 필터를 추가할 수 있습니다. 다음 예에서는 그 방법을 보여줍니다.</p>
<pre><code class="language-java"><span class="token class-name">SecurityManager</span> securityManager <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> route <span class="token operator">=</span> <span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/person"</span><span class="token punctuation">,</span> b1 <span class="token operator">-&gt;</span> b1
		<span class="token punctuation">.</span><span class="token function">nest</span><span class="token punctuation">(</span><span class="token function">accept</span><span class="token punctuation">(</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">,</span> b2 <span class="token operator">-&gt;</span> b2
			<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/{id}"</span><span class="token punctuation">,</span> handler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">getPerson</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span>handler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">listPeople</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span>handler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">createPerson</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>securityManager<span class="token punctuation">.</span><span class="token function">allowAccessTo</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>UNAUTHORIZED<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>앞의 예에서는 <code>next.handle(ServerRequest)</code> 호출이 선택 사항임을 보여줍니다. 접근이 허용된 경우에만 핸들러 기능이 실행되도록 합니다.</p>
<p>라우터 함수 빌더에서 <code>filter</code> 메소드를 사용하는 것 외에도 <code>RouterFunction.filter(HandlerFilterFunction)</code>를 통해 기존 라우터 함수에 필터를 적용하는 것이 가능합니다.</p>
<blockquote>
<p><strong>[Note]</strong><br>
기능적 엔드포인트에 대한 CORS 지원은 전용 <code>CorsFilter</code>를 통해 제공됩니다.</p>
</blockquote>